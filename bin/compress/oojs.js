!function(){var e={name:"oojs",namespace:"",classes:{},noop:function(){},$oojs:function(){var e={};if("undefined"!=typeof window&&window&&"undefined"!=typeof document&&document?(this.runtime="browser",e.global=window):(this.runtime="node",e.global=global),e.proxyName="proxy",e.path="node"===this.runtime?process.cwd()+"/src/":"/src/","undefined"!=typeof $oojs_config)for(var t in $oojs_config)t&&$oojs_config.hasOwnProperty(t)&&(e[t]=$oojs_config[t]);this.global=e.global,e.proxyName&&(Function.prototype[e.proxyName]=this.proxy),this.setPath(e.path),this.global.oojs=this.global.oojs||this},path:{},pathCache:{},getPath:function(e){var t=e?e.split("."):!1,s=this.path;if(t)for(var i=0,n=t.length;n>i;i++){var r=t[i].toLowerCase();if(!s[r])break;s=s[r]}return s.pathValue},setPath:function(e,t){var s=this.path;if("object"!=typeof e){if(t)for(var i=e.split("."),n=0,r=i.length;r>n;n++){var o=i[n].toLowerCase();s[o]=s[o]||{pathValue:s.pathValue},s=s[o]}else t=e;s.pathValue=t,this.pathCache={}}else for(var a in e)a&&e.hasOwnProperty(a)&&this.setPath(a,e[a])},getClassPath:function(e){if(!this.pathCache[e]){this.pathCache[e]=this.getPath(e)+e.replace(/\./gi,"/")+".js";var t=this.getPath(e),s=t.length-1;t.lastIndexOf("\\")!==s&&t.lastIndexOf("/")!==s&&(t+="/"),this.pathCache[e]=t+e.replace(/\./gi,"/")+".js"}return this.pathCache[e]},loadDeps:function(e,t){t=t||{};var s=e.__deps,i=(e.__namespace,[]);for(var n in s)if(s.hasOwnProperty(n)&&s[n]){var r;if("string"!=typeof s[n]?(e[n]=s[n],e[n]&&e[n].__name&&(r=e[n].__full)):(r=s[n],e[n]=this.find(r)),!r||t[r])continue;if(t[r]=!0,e[n])e[n].__deps&&(i=i.concat(this.loadDeps(e[n],t)));else{if("node"===this.runtime)try{e[n]=require(this.getClassPath(r))}catch(o){i.push(r)}e[n]||i.push(r)}}return i},fastClone:function(e){var t=function(){};t.prototype=e;var s=new t;return s},deepClone:function(e,t){"number"!=typeof t&&(t=10);var s,i=t-1;if(t>0)if(e instanceof Date)s=new Date,s.setTime(e.getTime());else if(e instanceof Array){s=[];for(var n=0,r=e.length;r>n;n++)s[n]=this.deepClone(e[n],i)}else if("object"==typeof e){s={};for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];s[o]=this.deepClone(a,i)}}else s=e;else s=e;return s},proxy:function(e,t,s,i,n,r,o){var a=[t];"undefined"!=typeof s&&a.push(s),"undefined"!=typeof i&&a.push(i),"undefined"!=typeof n&&a.push(n),"undefined"!=typeof r&&a.push(r),"undefined"!=typeof o&&a.push(o);var h=e,u="function"==typeof this?this:a.shift();return function(e,t,s,i,n){var r=[];return"undefined"!=typeof e&&r.push(e),"undefined"!=typeof t&&r.push(t),"undefined"!=typeof s&&r.push(s),"undefined"!=typeof i&&r.push(i),"undefined"!=typeof n&&r.push(n),u.apply(h,r.concat(a))}},find:function(e){var t,s=e.split(".");t=this.classes[s[0]];for(var i=1,n=s.length;n>i;i++){if(!t||!t[s[i]]){t=null;break}t=t[s[i]]}return t},reload:function(e){var t=this.find(e);if(t)if(t.__registed=!1,"node"===this.runtime){var s=this.getClassPath(e);delete require.cache[require.resolve(s)],t=require(s)}else t=this.define(t);else t=this.using(e);return t},create:function(e,t,s,i,n,r){"string"==typeof e&&(e=this.using(e));var o=new e.__constructor(t,s,i,n,r);return o},using:function(e){var t=this.find(e);return t||"node"===this.runtime&&(require(this.getClassPath(e)),t=this.find(e)),t},define:function(e){var t=e.name||"__tempName",s=e.namespace||"";e.__name=t,e.__namespace=s,e.__full=s.length>1?s+"."+t:t,e.__deps=e.deps,e.__oojs=this,e.__constructor=function(e,t,s,i,n){if(this.__clones&&this.__clones.length>0)for(var r=0,o=this.__clones.length;o>r;r++){var a=this.__clones[r];this[a]=this.__oojs.deepClone(this[a])}this.__constructorSource(e,t,s,i,n)},e.__constructorSource=e[t]||this.noop,e.__staticSource=e["$"+t]||this.noop,e.__staticUpdate=function(){var t=[];for(var s in this)if(this.hasOwnProperty(s)){var i=this[s];"object"!=typeof i||null===i||"deps"===s||0===s.indexOf("__")||e.__deps&&e.__deps[s]||t.push(s)}this.__clones=t,this.__constructor.prototype=this},e.__static=function(){this.__staticSource(),this.__staticUpdate()};for(var i,n=!1,r=!1,o=s.split("."),a=o.length,h=this.classes,u=0;a>u;u++)i=o[u],i&&(h[i]=h[i]||{},h=h[i]);h[t]=h[t]||{};var c=h;if(h=h[t],h.__name&&h.__registed){if(h.__registed){n=!0;for(var l in e)l&&e.hasOwnProperty(l)&&("undefined"==typeof h[l]||h[l]===this.noop)&&(r=!0,h[l]=e[l])}}else e.__registed=!0,c[t]=e;if(e=c[t],!n||r){var f=this.loadDeps(e);if(f.length>0){if(this.loader=this.loader||this.using("oojs.loader"),"browser"!==this.runtime||!this.loader)throw new Error('class "'+e.name+'" loadDeps error:'+f.join(","));this.loader.loadDepsBrowser(e,f)}else e.__static()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=e),e}};e.define(e)}(),oojs.define({name:"event",namespace:"oojs",eventList:null,groupList:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},createCallback:function(e,t,s){return e="undefined"!=typeof e?e:function(){},t="undefined"!=typeof t?t:1,s="undefined"!=typeof s?s:0,{callback:e,data:null,needTimes:t,emitTimes:s}},createEvent:function(e){var t={name:e,callbacks:[],callbackData:[],emitData:[],status:!1,groups:{}};return t},createGroup:function(e){var t={name:e,callbacks:[],callbackData:[],emitData:[],status:!1,events:{},previousGroups:{},afterGroups:{}};return t},bind:function(e,t,s){s="number"!=typeof s?1:s;var i=this.eventList[e]=this.eventList[e]||this.createEvent(e);if(i.callbacks.push(this.createCallback(t,s)),i.status&&i.emitData.length){for(var n=0,r=i.emitData.length;r>n;n++)this.emit(i.name,i.emitData[n]);i.emitData=[]}return this},removeListener:function(e,t){if(this.eventList[e]){var s=this.eventList[e];if(s.callbacks&&s.callbacks.length)for(var i=0,n=s.callbacks.length;n>i;i++)if(t){if(t===s.callbacks[i].callback){s.callbacks[i]=[];break}}else s.callbacks[i]=[]}},unbind:function(e,t){if(e||t)this.removeListener(e,t);else{var s;for(s in this.eventList)s&&this.eventList[s]&&this.eventList.hasOwnProperty(s)&&this.removeListener(s)}},emit:function(e,t){var s=this.eventList[e]=this.eventList[e]||this.createEvent(e);if(s.status=!0,s.callbacks&&s.callbacks.length){if(s.callbacks&&s.callbacks.length)for(var i=0,n=s.callbacks.length;n>i;i++){var r=s.callbacks[i],o=r.callback,a=!1;-1===r.needTimes?a=!0:r.needTimes>0&&r.emitTimes<r.needTimes&&(a=!0),r.emitTimes++,a&&o&&(r.data=o(t))}}else s.emitData.push(t);for(var h in s.groups)h&&s.groups.hasOwnProperty(h)&&s.groups[h]&&this.groupEmit(h);return this},group:function(e,t,s){var i=this.groupList[e]=this.groupList[e]||this.createGroup(e);if(s){s=s instanceof Array?s:[s];for(var n=0,r=s.length;r>n;n++)i.callbacks.push(this.createCallback(s[n],1))}var o;t="string"==typeof t?[t]:t;for(var n=0,r=t.length;r>n;n++)if(o=t[n],!i.events[o]){i.status=!1;var a=this.eventList[o]=this.eventList[o]||this.createEvent(o);a.groups[e]=1,i.events[o]=1}return t.length>0&&this.groupEmit(e),this},groupEmit:function(e){var t=this.groupList[e]=this.groupList[e]||this.createGroup(e),s=t.afterGroups,i=!0;for(var n in s)n&&s.hasOwnProperty(n)&&(this.groupList[n]?this.groupList[n].status||(i=!1):(this.groupList[n]=this.createGroup(n),i=!1));if(!i)return this;var r,o=t.events,a=!0;for(var h in o)if(h&&o.hasOwnProperty(h)&&o[h]&&(r=this.eventList[h]=this.eventList[h]||this.createEvent(h),!r.status)){a=!1;break}if(a){t.status=!0;var u={};for(var h in o)if(h&&o.hasOwnProperty(h)&&o[h]){var c=this.eventList[h].callbacks;u[h]=[];for(var l=0,f=c.length;f>l;l++)u[h].push(c[l].data);1===u[h].length&&(u[h]=u[h][0])}if(t.callbacks&&t.callbacks.length)for(var l=0,f=t.callbacks.length;f>l;l++){var p=t.callbacks[l],v=p.callback,d=!1;-1===p.needTimes?d=!0:p.needTimes>0&&p.emitTimes<p.needTimes&&(d=!0),p.emitTimes++,d&&v&&(p.data=v(u))}var g=t.previousGroups;for(var _ in g)_&&g.hasOwnProperty(_)&&this.groupEmit(_)}return this},queue:function(e,t){for(var s,i,n=Array.prototype.slice.apply(arguments),r=1,o=n.length;o>r;r++){s=n[r-1],i=n[r],s=s instanceof Array?s:[s],i=i instanceof Array?i:[i];for(var a=0,h=s.length;h>a;a++){var e=s[a];this.groupList[e]=this.groupList[e]||this.createGroup(e);for(var u=this.groupList[e],c=0,l=i.length;l>c;c++){var t=i[c];this.groupList[t]=this.groupList[t]||this.createGroup(t);var f=this.groupList[t];u.afterGroups[t]=1,f.previousGroups[e]=1}}}},afterGroup:function(e,t){var s=this.groupList[e]=this.groupList[e]||{},i=s.afters=s.afters||[];i.push(t)}}),oojs.define({name:"promise",namespace:"oojs",deps:{event:"oojs.event"},promise:function(e){if(this.ev=oojs.create(this.event),e)try{e(oojs.proxy(this,this._resolve),oojs.proxy(this,this._reject))}catch(t){this._reject(t)}},status:"pending",data:null,ev:null,defaultFunc:function(e){return e},_resolve:function(e){if(e&&"function"==typeof e.then){var t=e,s=oojs.proxy(this,function(e){this._resolve(e)}),i=oojs.proxy(this,function(e){this._reject(e)});t.then(s,i)}else if(this.status="fulfilled",this.data=e,this.ev.eventList&&this.ev.eventList.onRejected)try{this.ev.emit("onFulfilled",e)}catch(n){this._reject(n)}},resolve:function(e){var t=oojs.create(this);return t._resolve(e),t},_reject:function(e){return this.status="rejected",this.data=e,this.ev.eventList&&this.ev.eventList.onRejected&&this.ev.emit("onRejected",e),e},reject:function(e){var t=oojs.create(this);return t._reject(e),t},promisify:function(e,t){var s=function(){var s=oojs.create("oojs.promise"),i=Array.prototype.slice.apply(arguments),n=function(e){if(e)this._reject(e);else{var t=Array.prototype.slice.call(arguments,1);t.length<=1&&(t=t[0]),this._resolve(t)}};return i.push(oojs.proxy(s,n)),e.apply(t,i),s};return s},then:function(e,t){e=e||this.defaultFunc,t=t||this.defaultFunc;var s=oojs.create("oojs.promise"),i=oojs.proxy(s,function(e){this._resolve(e.onFulfilled)}),n=oojs.proxy(s,function(e){this._reject(e.onRejected)});return this.ev.bind("onFulfilled",e),this.ev.group("onFulfilledGroup","onFulfilled",i),this.ev.bind("onRejected",t),this.ev.group("onRejectedGroup","onRejected",n),"fulfilled"===this.status?setTimeout(oojs.proxy(this,function(){this._resolve(this.data)}),0):"rejected"===this.status&&setTimeout(oojs.proxy(this,function(){this._reject(this.data)}),0),s},"catch":function(e){this.then(null,e)},all:function(e){var t=oojs.create(this),s=oojs.create("oojs.event");s.bind("error",oojs.proxy(t,function(e){this._reject(e)}));for(var i=[],n=0,r=e.length;r>n;n++){var o="event-"+(n+1);i.push(o);var a=e[n];a.__eventName=o,a.allEvent=s,s.bind(o,function(e){return e});var h=function(e){this.allEvent.emit(this.__eventName,e)}.proxy(a),u=function(e){this.allEvent.emit("error",e),this.allEvent.unbind()}.proxy(a);a.then(h,u)}return s.group("all",i,function(e){var t=[];for(var s in e)t.push(e[s]);this._resolve(t)}.proxy(t)),t},race:function(e){var t=oojs.create(this),s=oojs.create("oojs.event");s.bind("success",oojs.proxy(t,function(e){this._resolve(e)})),s.bind("error",oojs.proxy(t,function(e){this._reject(e)}));for(var i=[],n=0,r=e.length;r>n;n++){var o="event-"+(n+1);i.push(o);var a=e[n],h=function(e){this.emit("success",e),this.unbind()}.proxy(s),u=function(e){this.emit("error",e),this.unbind()}.proxy(s);a.then(h,u)}return t}}),oojs.define({name:"loader",namespace:"oojs",deps:{event:"oojs.event"},$loader:function(){this.ev=oojs.create(this.event)},loadScript:function(e,t,s){if("function"==typeof t&&(s=t,t="1.0.0"),t=t||"1.0.0",t&&(e+="?v="+t),s=s||function(){},this.loading=this.loading||{},!this.loading[e]){this.loading[e]=1;var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onerror=i.onreadystatechange=function(e){/loaded|complete|undefined/.test(i.readyState)&&(i.onload=i.onerror=i.onreadystatechange=null,i=void 0,s())};var n=document.getElementsByTagName("script")[0];return n.parentNode.insertBefore(i,n),this}},loadDepsBrowser:function(e,t){var s=e.__full;this.ev.groupList[s]||this.ev.group(s,[],function(){oojs.reload(s)});for(var i=0,n=t.length;n>i;i++){var r=t[i];this.ev.eventList[r]||this.ev.bind(r,function(){return!0}),this.ev.group(s,r),this.ev.groupList[r]||(this.ev.group(r,[],function(e,t){oojs.reload(t)}.proxy(this,r)),this.ev.groupList[r].status=!0),this.ev.queue(s,r);var o=oojs.getClassPath(r),a=oojs.proxy(this,function(e){this.ev.emit(e,e)},r);this.loadScript(o,a)}return this}});