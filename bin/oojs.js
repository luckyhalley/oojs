!function(){var e={name:"oojs",namespace:"","class":{},$oojs:function(e){if(e=e||{},"undefined"!=typeof window&&"undefined"!=typeof document?(this.runtime="browser",e.global=window):(this.runtime="node",e.global=global),e.proxyName="proxy",e.path="node"===this.runtime?process.cwd()+"/src/":"","undefined"!=typeof $oojs_config)for(var t in $oojs_config)t&&$oojs_config.hasOwnProperty(t)&&(e[t]=$oojs_config[t]);this.global=e.global||{},e.proxyName&&(Function.prototype[e.proxyName]=this.proxy),this.setPath(e.path),this.global.oojs=this.global.oojs||this},path:{},pathCache:{},getPath:function(e){var t=e?e.split("."):!1,n=this.path;if(t)for(var s=0,a=t.length;a>s;s++){var r=t[s].toLowerCase();if(!n[r])break;n=n[r]}return n._path},setPath:function(e,t){var n=this.path;if("object"!=typeof e){if(t)for(var s=e.split("."),a=0,r=s.length;r>a;a++){var i=s[a].toLowerCase();n[i]=n[i]||{_path:n._path},n=n[i]}else t=e;t&&t.lastIndexOf("\\")!==t.length-1&&t.lastIndexOf("/")!==t.length-1&&(t+="/"),n._path=t}else for(var o in e)o&&e.hasOwnProperty(o)&&this.setPath(o,e[o])},getClassPath:function(e){return this.pathCache[e]||(this.pathCache[e]=this.getPath(e)+e.replace(/\./gi,"/")+".js"),this.pathCache[e]},loadDeps:function(e,t){t=t||{};var n=e.deps,s=[];for(var a in n)if(a&&n.hasOwnProperty(a)&&n[a]){var r;if("string"!=typeof n[a]?(e[a]=n[a],e[a]&&e[a].name&&(e[a].namespace=e[a].namespace||"",r=e[a].namespace+e[a].name)):(r=n[a],e[a]=this.find(r)),!r||t[r])continue;if(t[r]=!0,e[a])e[a].deps&&(s=s.concat(this.loadDeps(e[a],t)));else{if("node"===this.runtime&&(e[a]=require(this.getClassPath(r)),!e[a]))throw new Error(e.name+" loadDeps failed: "+r);e[a]||s.push(r)}}return s},fastClone:function(e){var t=function(){};t.prototype=e;var n=new t;return n},proxy:function(){var e=Array.prototype.slice.apply(arguments),t=e.shift(),n="function"==typeof this?this:e.shift();return function(){var s=Array.prototype.slice.apply(arguments);return n.apply(t,s.concat(e))}},config:function(){for(var e in obj)e&&obj.hasOwnProperty(e)&&("path"===e||"basePath"===e)&&this.setPath(obj[e])},create:function(e){var t=Array.prototype.slice.call(arguments,0);if(t.shift(),"string"==typeof e&&(e=this.using(e)),!e||!e.name)throw new Error("oojs.create need a class object with a name property");var n="__"+e.name||"init",s=function(){};s.prototype=e;var a=new s;for(var r in e){var i=e[r];i&&e.hasOwnProperty(r)&&"object"==typeof i&&(a[r]=this.fastClone(i))}return a[n]=a[n]||function(){},a[n].apply(a,t),a.instances=null,a},define:function(e){var t=e.name,n="$"+t;e.namespace=e.namespace||"",e.dispose=e.dispose||function(){},e["__"+t]=e[t]||function(){};for(var s,a=!1,r=!1,i=e.namespace.split("."),o=i.length,l=this.class,h=0;o>h;h++)s=i[h],s&&(l[s]=l[s]||{},l=l[s]);if(l[t]=l[t]||{},l[t].name&&l[t]._registed){if(l[t]._registed){a=!0;for(var c in e)c&&e.hasOwnProperty(c)&&"undefined"==typeof l[t][c]&&(r=!0,l[t][c]=e[c])}}else e._registed=!0,l[t]=e;if(e=l[t],!a||r){var u=this.loadDeps(e);if(u.length>0){if(this.loader=this.loader||this.using("oojs.loader"),"browser"!==this.runtime||!this.loader)throw new Error('class "'+e.name+'" loadDeps error:'+u.join(","));this.loader.loadDepsBrowser(e)}else e[n]&&e[n]()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=e),this},find:function(e){var t,n=e.split(".");t=this.class[n[0]];for(var s=1,a=n.length;a>s;s++){if(!t||!t[n[s]]){t=null;break}t=t[n[s]]}return t},using:function(e){var t=this.find(e);return t||"node"===this.runtime&&(require(this.getClassPath(e)),t=this.find(e)),t},reload:function(e){var t=this.find(e);if(t){if(t._registed=!1,"node"===this.runtime){var n=this.getClassPath(e);delete require.cache[require.resolve(n)],t=require(n)}}else t=this.using(e);return t}};e.define(e)}(),oojs.define({name:"event",namespace:"oojs",eventList:null,groupList:null,eventGroupIndexer:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},bind:function(e,t){var n=this.eventList[e]=this.eventList[e]||{};return n.status?t(n.emitData):((n.callbacks=n.callbacks||[]).push(t),n.status=!1),this},removeListener:function(e,t){if(this.eventList[e]){var n=this.eventList[e];if(n.callbacks&&n.callbacks.length)for(var s=0,a=n.callbacks.length;a>s;s++)if(t){if(t===n.callbacks[s]){n.callbacks[s]=null;break}}else n.callbacks[s]=null}},unbind:function(e,t){if(e||t)this.removeListener(e,t);else{var n;for(n in this.eventList)n&&this.eventList[n]&&this.eventList.hasOwnProperty(n)&&this.removeListener(n)}},emit:function(e,t){var n=this.eventList[e];if(n){if(n.callbacks&&n.callbacks.length){var s=n.callbacks.length;n.data=[];for(var a=0;s>a;a++){var r=n.callbacks[a];r&&n.data.push(r(t))}n.callbacks=null}}else n=this.eventList[e]={};n.status=!0,n.emitData=t||{};for(var i,o=this.eventGroupIndexer[e]||[],a=0,l=o.length;l>a;a++)i=o[a],i&&this.groupEmit(i)},group:function(e,t,n){this.groupList[e]=this.groupList[e]||{};var s=this.groupList[e],a=s.events=s.events||{};n&&(s.callbacks=s.callbacks||[]).push(n);for(var r,t=t||[],i=0,o=t.length;o>i;i++)r=t[i],a[r]=1,(this.eventGroupIndexer[r]=this.eventGroupIndexer[r]||[]).push(e)},groupEmit:function(e){var t=this.groupList[e];if(t){var n,s,a=t.events=t.events||{},r=!0,i={};for(n in a)if(n&&a.hasOwnProperty(n)){if(s=this.eventList[n],!s||!s.status){r=!1,i=null;break}i[n]=s.data}if(n=null,r){t.callbacks=t.callbacks||[];for(var o,l=t.callbacks,h=l.length||0,c=0;h>c;c++)o=t.callbacks[c],o&&(o(i),t.callbacks[c]=null);o=null,t.callbacks=null;for(var u,f=t.afters=t.afters||[],h=f.length||0,c=0;h>c;c++)u=f[c],u&&(u(i),f[c]=null);u=null,t.afters=null}}},afterGroup:function(e,t){var n=this.groupList[e]=this.groupList[e]||{},s=n.afters=n.afters||[];s.push(t)}}),oojs.define({name:"loader",namespace:"oojs",deps:{event:"oojs.event"},$loader:function(){this.ev=oojs.create(this.event)},isNullObj:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},loadScript:function(e,t,n){if("function"==typeof t&&(n=t,t="1.0.0"),t=t||"1.0.0",t&&(e+="?v="+t),n=n||function(){},this.ev.bind(e,oojs.proxy(this,function(e,t){t&&t()},n)),this.loading=this.loading||{},!this.loading[e]){this.loading[e]=1;var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onerror=s.onreadystatechange=oojs.proxy(this,function(e,t,n){"string"==typeof e&&(t=e,n=t),/loaded|complete|undefined/.test(n.readyState)&&(n.onload=n.onerror=n.onreadystatechange=null,n=void 0,this.ev.emit(t,1))},e,s);var a=document.getElementsByTagName("script")[0];return a.parentNode.insertBefore(s,a),this}},loadDepsBrowser:function(e){var t=e.deps,n="$"+e.name;if(this.isNullObj(t))e[n]&&e[n]();else for(var s in t)if(s&&t.hasOwnProperty(s)){var a=t[s],r=oojs.using(a);if(r){e[s]=r;continue}this.ev.bind(a,function(e){var t=oojs.using(e.classFullName);if(!t)throw new Error(e.classFullName+" load error in url: "+e.url);return t}),this.ev.group("loadDeps",[a],oojs.proxy(this,function(e,t,n,s){s[t]=e[n][0]},s,a,e)),this.ev.afterGroup("loadDeps",oojs.proxy(this,function(e,t){var n="$"+t.name;t[n]&&t[n]()},e));var i=oojs.getPath(e.namespace||""+e.name),o=oojs.proxy(this,function(e,t){this.ev.emit(e,{"class":e,url:t})},a,i);this.loadScript(i,o)}return oojs}});