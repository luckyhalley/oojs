!function(){var e={name:"oojs",namespace:"",classes:{},$oojs:function(e){if(e=e||{},"undefined"!=typeof window&&"undefined"!=typeof document?(this.runtime="browser",e.global=window):(this.runtime="node",e.global=global),e.proxyName="proxy",e.path="node"===this.runtime?process.cwd()+"/src/":"/src/","undefined"!=typeof $oojs_config)for(var t in $oojs_config)t&&$oojs_config.hasOwnProperty(t)&&(e[t]=$oojs_config[t]);this.global=e.global||{},e.proxyName&&(Function.prototype[e.proxyName]=this.proxy),this.setPath(e.path),this.global.oojs=this.global.oojs||this},path:{},pathCache:{},getPath:function(e){var t=e?e.split("."):!1,s=this.path;if(t)for(var n=0,a=t.length;a>n;n++){var i=t[n].toLowerCase();if(!s[i])break;s=s[i]}return s._path},setPath:function(e,t){var s=this.path;if("object"!=typeof e){if(t)for(var n=e.split("."),a=0,i=n.length;i>a;a++){var r=n[a].toLowerCase();s[r]=s[r]||{_path:s._path},s=s[r]}else t=e;t&&t.lastIndexOf("\\")!==t.length-1&&t.lastIndexOf("/")!==t.length-1&&(t+="/"),s._path=t}else for(var o in e)o&&e.hasOwnProperty(o)&&this.setPath(o,e[o])},getClassPath:function(e){return this.pathCache[e]||(this.pathCache[e]=this.getPath(e)+e.replace(/\./gi,"/")+".js"),this.pathCache[e]},loadDeps:function(e,t){t=t||{};var s=e.deps,n=[];for(var a in s)if(a&&s.hasOwnProperty(a)&&s[a]){var i;if("string"!=typeof s[a]?(e[a]=s[a],e[a]&&e[a].name&&(e[a].namespace=e[a].namespace||"",i=e[a].namespace+e[a].name)):(i=s[a],e[a]=this.find(i)),!i||t[i])continue;if(t[i]=!0,e[a])e[a].deps&&(n=n.concat(this.loadDeps(e[a],t)));else{if("node"===this.runtime&&(e[a]=require(this.getClassPath(i)),!e[a]))throw new Error(e.name+" loadDeps failed: "+i);e[a]||n.push(i)}}return n},fastClone:function(e){var t=function(){};t.prototype=e;var s=new t;return s},proxy:function(){var e=Array.prototype.slice.apply(arguments),t=e.shift(),s="function"==typeof this?this:e.shift();return function(){var n=Array.prototype.slice.apply(arguments);return s.apply(t,n.concat(e))}},config:function(){for(var e in obj)e&&obj.hasOwnProperty(e)&&("path"===e||"basePath"===e)&&this.setPath(obj[e])},create:function(e){var t=Array.prototype.slice.call(arguments,0);if(t.shift(),"string"==typeof e&&(e=this.using(e)),!e||!e.name)throw new Error("oojs.create need a class object with a name property");var s="__"+e.name||"init",n=function(){};n.prototype=e;var a=new n;for(var i in e){var r=e[i];r&&e.hasOwnProperty(i)&&"object"==typeof r&&(a[i]=this.fastClone(r))}return a[s]=a[s]||function(){},a[s].apply(a,t),a.instances=null,a},define:function(e){var t=e.name,s="$"+t;e.namespace=e.namespace||"",e.dispose=e.dispose||function(){},e["__"+t]=e[t]||function(){};for(var n,a=!1,i=!1,r=e.namespace.split("."),o=r.length,l=this.classes,c=0;o>c;c++)n=r[c],n&&(l[n]=l[n]||{},l=l[n]);if(l[t]=l[t]||{},l[t].name&&l[t]._registed){if(l[t]._registed){a=!0;for(var h in e)h&&e.hasOwnProperty(h)&&"undefined"==typeof l[t][h]&&(i=!0,l[t][h]=e[h])}}else e._registed=!0,l[t]=e;if(e=l[t],!a||i){var u=this.loadDeps(e);if(u.length>0){if(this.loader=this.loader||this.using("oojs.loader"),"browser"!==this.runtime||!this.loader)throw new Error('class "'+e.name+'" loadDeps error:'+u.join(","));this.loader.loadDepsBrowser(e)}else e[s]&&e[s]()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=e),this},find:function(e){var t,s=e.split(".");t=this.classes[s[0]];for(var n=1,a=s.length;a>n;n++){if(!t||!t[s[n]]){t=null;break}t=t[s[n]]}return t},using:function(e){var t=this.find(e);return t||"node"===this.runtime&&(require(this.getClassPath(e)),t=this.find(e)),t},reload:function(e){var t=this.find(e);if(t){if(t._registed=!1,"node"===this.runtime){var s=this.getClassPath(e);delete require.cache[require.resolve(s)],t=require(s)}}else t=this.using(e);return t}};e.define(e)}(),oojs.define({name:"event",namespace:"oojs",eventList:null,groupList:null,eventGroupIndexer:null,eventGroupIndexer:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},createEvent:function(e){var t={name:e,callbacks:[],callbackData:[],emitData:[],status:!1,groups:{}};return t},bind:function(e,t,s){2===arguments.length&&(s=t,t=1),t="undefined"==typeof t?1:t;var n=this.eventList[e]=this.eventList[e]||this.createEvent(e);return n.status?s(n.emitData):((n.callbacks=n.callbacks||[]).push({callback:s,needTimes:t,emitTimes:0}),n.status=!1),this},removeListener:function(e,t){if(this.eventList[e]){var s=this.eventList[e];if(s.callbacks&&s.callbacks.length)for(var n=0,a=s.callbacks.length;a>n;n++)if(t){if(t===s.callbacks[n].callback){s.callbacks[n]=null;break}}else s.callbacks[n]=null}},unbind:function(e,t){if(e||t)this.removeListener(e,t);else{var s;for(s in this.eventList)s&&this.eventList[s]&&this.eventList.hasOwnProperty(s)&&this.removeListener(s)}},emit:function(e,t){var s=this.eventList[e]=this.eventList[e]||this.createEvent(e);if(s.callbacks&&s.callbacks.length){var n=s.callbacks.length;s.callbackData=[];for(var a=0;n>a;a++){var i=s.callbacks[a],r=i.callback,o=!1;-1===i.needTimes?o=!0:i.needTimes>0&&i.emitTimes<i.needTimes&&(o=!0),i.emitTimes++,o&&r&&(i.data=r(t))}}s.status=!0,s.emitData=t||{};for(var l=s.groups||[],a=0,c=l.length;c>a;a++){var h=l[a];h&&this.groupEmit(h)}},group:function(e,t,s){this.groupList[e]=this.groupList[e]||{};{var n=this.groupList[e];n.events=n.events||{}}s&&(n.callbacks=n.callbacks||[]).push(s);for(var a,t=t||[],i=0,r=t.length;r>i;i++){a=t[i];var o=this.eventList[a]=this.eventList[a]||this.createEvent(a);o.groups[e]=n,n.events[a]=1}return this.groupEmit(e),this},groupEmit:function(e){var t,s,n=this.groupList[e],a=n.events=n.events||{},i=!0,r={};for(t in a)if(t&&a.hasOwnProperty(t)){if(s=this.eventList[t],!s||!s.status){i=!1,r=null;break}r[t]=s.callbackData}if(t=null,i){n.callbacks=n.callbacks||[];for(var o,l=n.callbacks,c=l.length||0,h=0;c>h;h++)o=n.callbacks[h],o&&(o(r),n.callbacks[h]=null);o=null,n.callbacks=null;for(var u,f=n.afters=n.afters||[],c=f.length||0,h=0;c>h;h++)u=f[h],u&&(u(r),f[h]=null);u=null,n.afters=null}},afterGroup:function(e,t){var s=this.groupList[e]=this.groupList[e]||{},n=s.afters=s.afters||[];n.push(t)}}),oojs.define({name:"loader",namespace:"oojs",deps:{event:"oojs.event"},$loader:function(){this.ev=oojs.create(this.event)},isNullObj:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},loadScript:function(e,t,s){if("function"==typeof t&&(s=t,t="1.0.0"),t=t||"1.0.0",t&&(e+="?v="+t),s=s||function(){},this.ev.bind(e,oojs.proxy(this,function(e,t){t&&t()},s)),this.loading=this.loading||{},!this.loading[e]){this.loading[e]=1;var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onerror=n.onreadystatechange=oojs.proxy(this,function(e,t,s){"string"==typeof e&&(t=e,s=t),/loaded|complete|undefined/.test(s.readyState)&&(s.onload=s.onerror=s.onreadystatechange=null,s=void 0,this.ev.emit(t,1))},e,n);var a=document.getElementsByTagName("script")[0];return a.parentNode.insertBefore(n,a),this}},loadDepsBrowser:function(e){var t=e.deps,s="$"+e.name;if(this.isNullObj(t))e[s]&&e[s]();else for(var n in t)if(n&&t.hasOwnProperty(n)){var a=t[n],i=oojs.using(a);if(i){e[n]=i;continue}this.ev.bind(a,function(e){var t=oojs.using(e.classFullName);if(!t)throw new Error(e.classFullName+" load error in url: "+e.url);return t}),this.ev.group("loadDeps",[a],oojs.proxy(this,function(e,t,s,n){n[t]=e[s][0]},n,a,e)),this.ev.afterGroup("loadDeps",oojs.proxy(this,function(e,t){var s="$"+t.name;t[s]&&t[s]()},e));var r=oojs.getClassPath(a),o=oojs.proxy(this,function(e,t){this.ev.emit(e,{classFullName:e,url:t})},a,r);this.loadScript(r,o)}return oojs}});