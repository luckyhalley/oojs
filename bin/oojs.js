!function(){var t={name:"oojs",namespace:"",classes:{},$oojs:function(){var t={};if("undefined"!=typeof window&&"undefined"!=typeof document?(this.runtime="browser",t.global=window):(this.runtime="node",t.global=global),t.proxyName="proxy",t.path="node"===this.runtime?process.cwd()+"/src/":"/src/","undefined"!=typeof $oojs_config)for(var e in $oojs_config)e&&$oojs_config.hasOwnProperty(e)&&(t[e]=$oojs_config[e]);this.global=t.global||{},t.proxyName&&(Function.prototype[t.proxyName]=this.proxy),this.setPath(t.path),this.global.oojs=this.global.oojs||this},path:{},pathCache:{},getPath:function(t){var e=t?t.split("."):!1,s=this.path;if(e)for(var r=0,a=e.length;a>r;r++){var i=e[r].toLowerCase();if(!s[i])break;s=s[i]}return s._path},setPath:function(t,e){var s=this.path;if("object"!=typeof t){if(e)for(var r=t.split("."),a=0,i=r.length;i>a;a++){var n=r[a].toLowerCase();s[n]=s[n]||{_path:s._path},s=s[n]}else e=t;e&&e.lastIndexOf("\\")!==e.length-1&&e.lastIndexOf("/")!==e.length-1&&(e+="/"),s._path=e}else for(var o in t)o&&t.hasOwnProperty(o)&&this.setPath(o,t[o])},getClassPath:function(t){return this.pathCache[t]||(this.pathCache[t]=this.getPath(t)+t.replace(/\./gi,"/")+".js"),this.pathCache[t]},loadDeps:function(t,e){e=e||{};var s=t.deps,r=[];for(var a in s)if(a&&s.hasOwnProperty(a)&&s[a]){var i;if("string"!=typeof s[a]?(t[a]=s[a],t[a]&&t[a].name&&(t[a].namespace=t[a].namespace||"",i=t[a].namespace+t[a].name)):(i=s[a],t[a]=this.find(i)),!i||e[i])continue;if(e[i]=!0,t[a])t[a].deps&&(r=r.concat(this.loadDeps(t[a],e)));else{if("node"===this.runtime&&(t[a]=require(this.getClassPath(i)),!t[a]))throw new Error(t.name+" loadDeps failed: "+i);t[a]||r.push(i)}}return r},fastClone:function(t){var e=function(){};e.prototype=t;var s=new e;return s},proxy:function(){var t=Array.prototype.slice.apply(arguments),e=t.shift(),s="function"==typeof this?this:t.shift();return function(){var r=Array.prototype.slice.apply(arguments);return s.apply(e,r.concat(t))}},find:function(t){var e,s=t.split(".");e=this.classes[s[0]];for(var r=1,a=s.length;a>r;r++){if(!e||!e[s[r]]){e=null;break}e=e[s[r]]}return e},reload:function(t){var e=this.find(t);if(e)if(e._registed=!1,"node"===this.runtime){var s=this.getClassPath(t);delete require.cache[require.resolve(s)],e=require(s)}else this.define(e);else e=this.using(t);return e},create:function(t){var e=Array.prototype.slice.call(arguments,0);if(e.shift(),"string"==typeof t&&(t=this.using(t)),!t||!t.name)throw new Error("oojs.create need a class object with a name property");var s="__"+t.name||"init",r=function(){};r.prototype=t;var a=new r;for(var i in t)if(i&&t.hasOwnProperty(i)){var n=t[i];"object"==typeof n&&(a[i]=this.fastClone(n))}return a[s]&&a[s].apply(a,e),a},using:function(t){var e=this.find(t);return e||"node"===this.runtime&&(require(this.getClassPath(t)),e=this.find(t)),e},define:function(t){var e=t.name,s="$"+e;t.namespace=t.namespace||"",t.dispose=t.dispose||function(){},t["__"+e]=t[e]||function(){},t.__static_constructor=t[s]||function(){};for(var r,a=!1,i=!1,n=t.namespace.split("."),o=n.length,h=this.classes,l=0;o>l;l++)r=n[l],r&&(h[r]=h[r]||{},h=h[r]);if(h[e]=h[e]||{},h[e].name&&h[e]._registed){if(h[e]._registed){a=!0;for(var c in t)c&&t.hasOwnProperty(c)&&"undefined"==typeof h[e][c]&&(i=!0,h[e][c]=t[c])}}else t._registed=!0,h[e]=t;if(t=h[e],!a||i){var u=this.loadDeps(t);if(u.length>0){if(this.loader=this.loader||this.using("oojs.loader"),"browser"!==this.runtime||!this.loader)throw new Error('class "'+t.name+'" loadDeps error:'+u.join(","));this.loader.loadDepsBrowser(t,u)}else t[s]&&t[s]()}return"node"===this.runtime&&arguments.callee.caller.arguments[2]&&(arguments.callee.caller.arguments[2].exports=t),this}};t.define(t)}(),oojs.define({name:"event",namespace:"oojs",eventList:null,groupList:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},createCallback:function(t,e,s){return t="undefined"!=typeof t?t:function(){},e="undefined"!=typeof e?e:1,s="undefined"!=typeof s?s:0,{callback:t,data:null,needTimes:e,emitTimes:s}},createEvent:function(t){var e={name:t,callbacks:[],callbackData:[],emitData:[],status:!1,groups:{}};return e},createGroup:function(t){var e={name:t,callbacks:[],callbackData:[],emitData:[],status:!1,events:{},previousGroups:{},afterGroups:{}};return e},bind:function(t,e,s){2===arguments.length&&(s=e,e=1),e="number"!=typeof e?1:e;var r=this.eventList[t]=this.eventList[t]||this.createEvent(t);s=s instanceof Array?s:[s];for(var a=0,i=s.length;i>a;a++)r.callbacks.push(this.createCallback(s[a],e));if(r.status&&r.emitData.length){for(var a=0,i=r.emitData.length;i>a;a++)this.emit(r.name,r.emitData[a]);r.emitData=[]}return this},removeListener:function(t,e){if(this.eventList[t]){var s=this.eventList[t];if(s.callbacks&&s.callbacks.length)for(var r=0,a=s.callbacks.length;a>r;r++)if(e){if(e===s.callbacks[r].callback){s.callbacks[r]=null;break}}else s.callbacks[r]=null}},unbind:function(t,e){if(t||e)this.removeListener(t,e);else{var s;for(s in this.eventList)s&&this.eventList[s]&&this.eventList.hasOwnProperty(s)&&this.removeListener(s)}},emit:function(t,e){var s=this.eventList[t]=this.eventList[t]||this.createEvent(t);if(s.status=!0,s.callbacks&&s.callbacks.length){if(s.callbacks&&s.callbacks.length)for(var r=0,a=s.callbacks.length;a>r;r++){var i=s.callbacks[r],n=i.callback,o=!1;-1===i.needTimes?o=!0:i.needTimes>0&&i.emitTimes<i.needTimes&&(o=!0),i.emitTimes++,o&&n&&(i.data=n(e))}}else s.emitData.push(e);for(var h in s.groups)h&&s.groups.hasOwnProperty(h)&&s.groups[h]&&this.groupEmit(h);return this},group:function(t,e,s){var r=this.groupList[t]=this.groupList[t]||this.createGroup(t);if(s){s=s instanceof Array?s:[s];for(var a=0,i=s.length;i>a;a++)r.callbacks.push(this.createCallback(s[a],1))}var n;e="string"==typeof e?[e]:e;for(var a=0,i=e.length;i>a;a++)if(n=e[a],!r.events[n]){r.status=!1;var o=this.eventList[n]=this.eventList[n]||this.createEvent(n);o.groups[t]=1,r.events[n]=1}return e.length>0&&this.groupEmit(t),this},groupEmit:function(t){var e=this.groupList[t]=this.groupList[t]||this.createGroup(t),s=e.afterGroups,r=!0;for(var a in s)a&&s.hasOwnProperty(a)&&(this.groupList[a]?this.groupList[a].status||(r=!1):(this.groupList[a]=this.createGroup(a),r=!1));if(!r)return this;var i,n=e.events,o=!0;for(var h in n)if(h&&n.hasOwnProperty(h)&&n[h]&&(i=this.eventList[h]=this.eventList[h]||this.createEvent(h),!i.status)){o=!1;break}if(o){e.status=!0;var l={};for(var h in n)if(h&&n.hasOwnProperty(h)&&n[h]){var c=this.eventList[h].callbacks;l[h]=[];for(var u=0,p=c.length;p>u;u++)l[h].push(c[u].data);1===l[h].length&&(l[h]=l[h][0])}if(e.callbacks&&e.callbacks.length)for(var u=0,p=e.callbacks.length;p>u;u++){var f=e.callbacks[u],v=f.callback,g=!1;-1===f.needTimes?g=!0:f.needTimes>0&&f.emitTimes<f.needTimes&&(g=!0),f.emitTimes++,g&&v&&(f.data=v(l))}var d=e.previousGroups;for(var m in d)m&&d.hasOwnProperty(m)&&this.groupEmit(m)}return this},queue:function(t,e){for(var s,r,a=Array.prototype.slice.apply(arguments),i=1,n=a.length;n>i;i++){s=a[i-1],r=a[i],s=s instanceof Array?s:[s],r=r instanceof Array?r:[r];for(var o=0,h=s.length;h>o;o++){var t=s[o];this.groupList[t]=this.groupList[t]||this.createGroup(t);for(var l=this.groupList[t],c=0,u=r.length;u>c;c++){var e=r[c];this.groupList[e]=this.groupList[e]||this.createGroup(e);var p=this.groupList[e];l.afterGroups[e]=1,p.previousGroups[t]=1}}}},afterGroup:function(t,e){var s=this.groupList[t]=this.groupList[t]||{},r=s.afters=s.afters||[];r.push(e)}}),oojs.define({name:"loader",namespace:"oojs",deps:{event:"oojs.event"},$loader:function(){this.ev=oojs.create(this.event)},loadScript:function(t,e,s){if("function"==typeof e&&(s=e,e="1.0.0"),e=e||"1.0.0",e&&(t+="?v="+e),s=s||function(){},this.loading=this.loading||{},!this.loading[t]){this.loading[t]=1;var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onerror=r.onreadystatechange=function(){/loaded|complete|undefined/.test(r.readyState)&&(r.onload=r.onerror=r.onreadystatechange=null,r=void 0,s())};var a=document.getElementsByTagName("script")[0];return a.parentNode.insertBefore(r,a),this}},loadDepsBrowser:function(t,e){var s=t.namespace?t.namespace+"."+t.name:t.name;this.ev.groupList[s]||this.ev.group(s,[],function(){oojs.reload(s)});for(var r=0,a=e.length;a>r;r++){var i=e[r];this.ev.eventList[i]||this.ev.bind(i,function(){return!0}),this.ev.group(s,i),this.ev.groupList[i]||(this.ev.group(i,[],function(t,e){oojs.reload(e)}.proxy(this,i)),this.ev.groupList[i].status=!0),this.ev.queue(s,i);var n=oojs.getClassPath(i),o=oojs.proxy(this,function(t){console.log("event:"+t),this.ev.emit(t,t)},i);this.loadScript(n,o)}return this}});