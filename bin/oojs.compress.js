!function(){var t={name:"oojs",namespace:"",conf:{global:!1,proxyName:"proxy",path:""},$oojs:function(){if(this.conf="undefined"!=typeof $oojs_config?$oojs_config:this.conf,"undefined"!=typeof window)this.global=this.conf.global||window,this.runtime="browser",this.setPath(this.conf.path);else if(global){this.global=this.conf.global||global,this.runtime="node",this.conf.path=this.conf.path||process.cwd()+"/src/",this.setPath(this.conf.path);var e=module.constructor,n=e.wrap;e.wrap=function(t){return t=t.replace(/^\s*(define\s*&&\s*)?define\s*\(/gi,"oojs.define(module,"),n(t)},module.exports=this}this.conf.proxyName&&(Function.prototype[this.conf.proxyName]=this.proxy),this.global.define=this.proxy(this,this.define),this.global.oojs=t},path:{},pathCache:{},getPath:function(t){var e=t?t.split("."):!1,n=this.path;if(e)for(var s=0,i=e.length;i>s;s++){var r=e[s].toLowerCase();if(!n[r])break;n=n[r]}return n._path},setPath:function(t,e){var n=this.path;if("object"!=typeof t){if(e)for(var s=t.split("."),i=0,r=s.length;r>i;i++){var a=s[i].toLowerCase();n[a]=n[a]||{_path:n._path},n=n[a]}else e=t;e&&e.lastIndexOf("\\")!==e.length-1&&e.lastIndexOf("/")!==e.length-1&&(e+="/"),n._path=e}else for(var o in t)o&&t.hasOwnProperty(o)&&this.setPath(o,t[o])},getClassPath:function(t){return this.pathCache[t]||(this.pathCache[t]=this.getPath(t)+t.replace(/\./gi,"/")+".js"),this.pathCache[t]},loadDeps:function(t,e){e=e||{};var n=t.deps,s=!0;for(var i in n)if(i&&n.hasOwnProperty(i)&&n[i]){var r;if("string"!=typeof n[i]?(t[i]=n[i],t[i]&&t[i].name&&(t[i].namespace=t[i].namespace||"",r=t[i].namespace+t[i].name)):(r=n[i],t[i]=this.find(r)),!r||e[r])continue;e[r]=!0,t[i]?t[i].deps&&(s=s&&this.loadDeps(t[i],e)):("node"===this.runtime&&(t[i]=require(this.getClassPath(r))),t[i]||(s=!1))}return s},fastClone:function(t){var e=function(){};e.prototype=t;var n=new e;return n},proxy:function(){var t=Array.prototype.slice.apply(arguments),e=t.shift(),n="function"==typeof this?this:t.shift();return function(){var s=Array.prototype.slice.apply(arguments);return n.apply(e,s.concat(t))}},config:function(t){for(var e in t)e&&t.hasOwnProperty(e)&&("path"===e?this.setPath(t[e]):this.conf[e]=t[e])},create:function(t){var e=Array.prototype.slice.call(arguments,0);if(e.shift(),"string"==typeof t&&(t=this.using(t)),!t||!t.name)throw new Error("oojs.create need a class object with a name property");var n=t.name||"init",s=function(t){this[n]=this[n]||function(){},this[n].apply(this,t)};s.prototype=t;var i=new s(e);for(var r in t){var a=t[r];a&&t.hasOwnProperty(r)&&"object"==typeof a&&(i[r]=this.fastClone(a))}return i.instances=null,i},define:function(t,e){e||(e=t);var n=e.name,s="$"+n;e.namespace=e.namespace||"",e.dispose=e.dispose||function(){};for(var i,r=e.namespace.split("."),a=r.length,o=this.global,h=0;a>h;h++)i=r[h],i&&(o[i]=o[i]||{},o=o[i]);o[n]=o[n]||{};var l=!1;if(o[n].name&&o[n]._registed){if(o[n]._registed){for(var f in e)f&&e.hasOwnProperty(f)&&"undefined"==typeof o[n][f]&&(l=!0,o[n][f]=e[f]);if(e=o[n],!l)return this}}else e._registed=!0,o[n]=e;e=o[n];var c=this.loadDeps(e);return!c&&"browser"===this.runtime&&this.loadDepsBrowser?this.loadDepsBrowser(e):e[s]&&e[s](),t&&"node"===this.runtime&&(t.exports=e),this},find:function(t){var e,n=t.split(".");e=this.global[n[0]];for(var s=1,i=n.length;i>s;s++){if(!e||!e[n[s]]){e=null;break}e=e[n[s]]}return e},using:function(t){var e=this.find(t);return e||"node"===this.runtime&&(require(this.getClassPath(t)),e=this.find(t)),e},reload:function(t){var e=this.find(t);if(e){if(e._registed=!1,"node"===this.runtime){var n=this.getClassPath(t);delete require.cache[require.resolve(n)],e=require(n)}}else e=this.using(t);return e}};return t.$oojs(),t.define("undefined"!=typeof module?module:null,t),t}(),define&&define({name:"event",namespace:"oojs",eventList:null,groupList:null,eventGroupIndexer:null,$event:function(){},event:function(){this.eventList={},this.groupList={},this.eventGroupIndexer={}},bind:function(t,e){var n=this.eventList[t]=this.eventList[t]||{};return(n.callbacks=n.callbacks||[]).push(e),n.status=!1,this},removeListener:function(t,e){if(this.eventList[t]){var n=this.eventList[t];if(n.callbacks&&n.callbacks.length)for(var s=0,i=n.callbacks.length;i>s;s++)if(e){if(e===n.callbacks[s]){n.callbacks[s]=null;break}}else n.callbacks[s]=null}},unbind:function(t,e){if(t||e)this.removeListener(t,e);else{var n;for(n in this.eventList)n&&this.eventList[n]&&this.eventList.hasOwnProperty(n)&&this.removeListener(n)}},emit:function(t,e){var n=this.eventList[t];if(n&&n.callbacks&&n.callbacks.length){var s=n.callbacks.length;n.data=[];for(var i=0;s>i;i++){var r=n.callbacks[i];r&&n.data.push(r(e))}n.callbacks=null,n.status=!0}for(var a,o=this.eventGroupIndexer[t]||[],i=0,h=o.length;h>i;i++)a=o[i],a&&this.groupEmit(a)},group:function(t,e,n){this.groupList[t]=this.groupList[t]||{};var s=this.groupList[t],i=s.events=s.events||{};n&&(s.callbacks=s.callbacks||[]).push(n);for(var r,e=e||[],a=0,o=e.length;o>a;a++)r=e[a],i[r]=1,(this.eventGroupIndexer[r]=this.eventGroupIndexer[r]||[]).push(t)},groupEmit:function(t){var e=this.groupList[t];if(e){var n,s,i=e.events=e.events||{},r=!0,a={};for(n in i)if(n&&i.hasOwnProperty(n)){if(s=this.eventList[n],!s||!s.status){r=!1,a=null;break}a[n]=s.data}if(n=null,r){e.callbacks=e.callbacks||[];for(var o,h=e.callbacks,l=h.length||0,f=0;l>f;f++)o=e.callbacks[f],o&&(o(a),e.callbacks[f]=null);o=null,e.callbacks=null;for(var c,u=e.afters=e.afters||[],l=u.length||0,f=0;l>f;f++)c=u[f],c&&(c(a),u[f]=null);c=null,e.afters=null}}},afterGroup:function(t,e){var n=this.groupList[t]=this.groupList[t]||{},s=n.afters=n.afters||[];s.push(e)}}),define&&define({name:"oojs",namespace:"",ev:oojs.create(oojs.event),isNullObj:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},loadScript:function(t,e,n){if("function"==typeof e&&(n=e,e="1.0.0"),e=e||"1.0.0",t.indexOf("http")<0&&(t=this.basePath+t.replace(/\./g,"/")+".js"),e&&(t+="?v="+e),n=n||function(){},this.ev.bind(t,function(t,e){e&&e()}.proxy(this,n)),this.loading=this.loading||{},!this.loading[t]){this.loading[t]=1;var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=t,s.onload=s.onerror=s.onreadystatechange=function(t,e,n){"string"==typeof t&&(e=t,n=e),/loaded|complete|undefined/.test(n.readyState)&&(n.onload=n.onerror=n.onreadystatechange=null,n=void 0,this.ev.emit(e,1))}.proxy(this,t,s);var i=document.getElementsByTagName("script")[0];return i.parentNode.insertBefore(s,i),this}},loadDepsBrowser:function(t){var e=t.deps,n="$"+t.name;if(this.isNullObj(e))t[n]&&t[n]();else for(var s in e)if(s&&e.hasOwnProperty(s)){var i=e[s],r=this.using(i);if(r){t[s]=r;continue}this.ev.bind(i,function(t,e){return oojs.using(e)}.proxy(this,i)),this.ev.group("loadDeps",[i],function(t,e,n,s){s[e]=t[n][0]}.proxy(this,s,i,t)),this.ev.afterGroup("loadDeps",function(){var e="$"+t.name;t[e]&&t[e]()}.proxy(this,t));var a=this.basePath+i.replace(/\./gi,"/")+".js",o=function(t){this.ev.emit(t)}.proxy(this,i);this.loadScript(a,o)}return this}});